# Sage v4 설정 - 병렬 실행 지원
#
# 역할 정의:
#   - "role"              → 순차 실행
#   - ["role1", "role2"]  → 병렬 실행 (둘 다 완료해야 다음으로)

chains:
  FULL:
    roles:
      - sage                                          # Phase 1: 안건 접수
      - [ideator-ijo, ideator-hojo, ideator-yejo,
         ideator-byeongjo, ideator-hyeongjo, ideator-gongjo]  # Phase 2: 6조 낭청 병렬
      - [analyst-ijo, analyst-hojo, analyst-yejo,
         analyst-byeongjo, analyst-hyeongjo, analyst-gongjo]  # Phase 3: 6조 판서 병렬
      - [seungji-ijo, seungji-hojo, seungji-yejo,
         seungji-byeongjo, seungji-hyeongjo, seungji-gongjo]  # Phase 4: 6조 승지 병렬
      - doseungji                                     # Phase 5: 도승지 (6승지 취합)
      - [sagawon, saheonbu, hongmungwan]             # Phase 6: 삼사 병렬 (간쟁/감찰/자문)
      - dohwaseo                                      # Phase 7: 도화서 (설계 수립)
      - [jwauijeong, uuijeong]                        # Phase 8: 좌의정+우의정 병렬
      - sage                                          # Phase 9: 실행 허가
      - [executor-ijo, executor-hojo, executor-yejo,
         executor-byeongjo, executor-hyeongjo, executor-gongjo]  # Phase 10: 6조 집행관 병렬
      - doseungji                                     # Phase 11: 도승지 (실행 결과 취합)
      - [amhaeng, gyoseogwan]                         # Phase 12: 암행어사+교서관 병렬
      - sage                                          # Phase 13: 최종 결재
      - [chunchugwan, seungmunwon, gyujanggak]       # Phase 14: 춘추관+승문원+규장각 병렬

    triggers:
      keywords: [새로운, 개발, 구현, 기능, 추가, 만들어, new, feature]
      complexity: [중간, 복잡]

    branches:
      - from: sagawon
        to: ideator
        condition: [reject, 반려, 거절, 재검토, 보완필요]
        max_loops: 2

      - from: analyst
        to: feasibility-checker
        condition: [uncertain, 불확실, 추가검토, 확인필요]
        max_loops: 3

      - from: jwauijeong
        to: dohwaseo
        condition: [reject, 반려, 재설계]
        max_loops: 2

      - from: uuijeong
        to: dohwaseo
        condition: [reject, 반려, 재설계]
        max_loops: 2

      - from: amhaeng
        to: executor
        condition: [reject, 반려, 결함발견]
        max_loops: 2

      - from: gyoseogwan
        to: executor
        condition: [reject, fail, 테스트실패]
        max_loops: 2

    exit_conditions:
      - role: saheonbu
        keywords: [차단, block, 불가, 금지]
        reason: "RULES 위반으로 즉시 종료"

      - role: sage
        keywords: [거부, reject, 불가, 기각]
        reason: "Sage 거부로 종료"

  QUICK:
    roles:
      - sagawon                    # 사간원
      - dohwaseo                   # 도화서
      - executor
      - [amhaeng, gyoseogwan]      # 암행어사+교서관 병렬
      - chunchugwan                # 춘추관

    triggers:
      keywords: [버그, 수정, 고침, 패치, 에러, 오류, fix, bug, hotfix]
      complexity: [단순, 중간]

    branches: []
    exit_conditions: []

  REVIEW:
    roles:
      - [sagawon, gyoseogwan]      # 사간원+교서관 병렬

    triggers:
      keywords: [검토, 리뷰, 확인, 체크, 점검, review, check]
      complexity: [단순]

    branches: []
    exit_conditions: []

  DESIGN:
    roles:
      - ideator
      - analyst
      - sagawon                    # 사간원
      - dohwaseo                   # 도화서

    triggers:
      keywords: [설계, 아키텍처, 구조, 계획, design, architecture]
      complexity: [중간, 복잡]

    branches:
      - from: analyst
        to: feasibility-checker
        condition: [uncertain, 불확실]
        max_loops: 3

    exit_conditions: []

  RESEARCH:
    roles:
      - [ideator, hongmungwan]     # 낭청+홍문관 병렬
      - analyst
      - sagawon                    # 사간원

    triggers:
      keywords: [조사, 연구, 탐색, research, explore, investigate]
      complexity: [단순, 중간]

    branches: []
    exit_conditions: []

defaults:
  fallback_chain: FULL
  max_total_branches: 5
  timeout_minutes: 60
