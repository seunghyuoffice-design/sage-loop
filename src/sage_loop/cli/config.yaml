# Sage 설정

# 체인 정의 (CLAUDE.md SAGE_LOOP 기준, 15단계)
chains:
  FULL:
    roles:
      - ideator           # Phase 1: 아이디어 생성
      - analyst           # Phase 2: 분석/선별
      - critic            # Phase 3: 위험/결함 비판
      - censor            # Phase 4: RULES 사전 봉쇄
      - academy           # Phase 5: 학술 자문
      - architect         # Phase 6: 설계 수립
      - left-state-councilor   # Phase 7: 내정 검토
      - right-state-councilor  # Phase 8: 실무 검토
      - sage              # Phase 9: 최종 승인 (영의정)
      - executor          # Phase 10: 구현
      - inspector         # Phase 11: 감찰
      - validator         # Phase 12: 검증
      - historian         # Phase 13: 기록
      - reflector         # Phase 14: 회고
      - improver          # Phase 15: 개선
    triggers:
      keywords: [새로운, 개발, 구현, 기능, 추가, 만들어]
      complexity: [중간, 복잡]
      risk: [보통, 높음]
    branches:
      - from: analyst
        to: feasibility-checker
        condition: "feasibility_uncertain"
        max_loops: 3
      - from: critic
        to: constraint-enforcer
        condition: "constraint_violation"
        max_loops: 2
      - from: censor
        to: policy-keeper
        condition: "rules_violation"
        max_loops: 2

  QUICK:
    roles: [critic, architect, executor, validator, historian]
    triggers:
      keywords: [버그, 수정, 고침, 패치, 에러, 오류]
      complexity: [단순, 중간]
      risk: [낮음, 보통]
    branches: []

  REVIEW:
    roles: [critic, validator]
    triggers:
      keywords: [검토, 리뷰, 확인, 체크, 점검]
      complexity: [단순]
      risk: [낮음]
    branches: []

  DESIGN:
    roles: [ideator, analyst, critic, architect]
    triggers:
      keywords: [설계, 아키텍처, 구조, 계획, 방향]
      complexity: [중간, 복잡]
      risk: [보통]
    branches:
      - from: analyst
        to: feasibility-checker
        condition: "feasibility_uncertain"
        max_loops: 3

# 사용자 개입 지점
user_intervention_points:
  CHAIN_SELECTED:
    trigger: "체인 결정 완료"
    required: true
    message: "선택된 체인으로 진행하시겠습니까?"

  BRANCH_DECISION:
    trigger: "분기 발생"
    required: true
    message: "분기가 필요합니다. 진행하시겠습니까?"

  CRITICAL_RISK:
    trigger: "Critic 위험도 HIGH"
    required: true
    message: "높은 위험이 감지되었습니다. 진행하시겠습니까?"

  BEFORE_EXECUTE:
    trigger: "Executor 직전"
    required: false  # 설정 가능
    message: "구현을 시작합니다. 확인하시겠습니까?"

# 기본 설정
defaults:
  fallback_chain: FULL
  auto_confirm: false
  max_total_branches: 5
  timeout_minutes: 60

# 실행 모드 설정 (3가지 모드)
execution_modes:
  full-auto:
    description: "완전 자동 실행"
    user_approval_points: []
    auto_branch: true
    error_handling: "auto_recover"
    recommended_for:
      keywords: [긴급, 빨리, 수정, 버그, 패치, hotfix]

  plan-first:
    description: "계획 승인 후 실행"
    user_approval_points: ["plan"]
    auto_branch: true
    error_handling: "interactive"
    recommended_for:
      keywords: [신규, 기능, 개발, 구현, 추가, new, feature]

  interactive:
    description: "각 단계마다 승인 요청"
    user_approval_points: ["every_role"]
    auto_branch: false
    error_handling: "user_choice"
    recommended_for:
      keywords: [복잡, 불확실, 리스크, 위험, 마이그레이션]
      complexity: [복잡]
      risk: [높음]

default_mode: "plan-first"

# 복잡도 판단 기준
complexity_criteria:
  단순:
    - 단일 파일 변경
    - 명확한 문제
    - 의존성 없음
  중간:
    - 2-5개 파일 변경
    - 일부 의존성
    - 테스트 필요
  복잡:
    - 6개 이상 파일 변경
    - 다중 의존성
    - 아키텍처 영향

# 위험도 판단 기준
risk_criteria:
  낮음:
    - 국소적 변경
    - 롤백 용이
    - 데이터 영향 없음
  보통:
    - 중간 범위 변경
    - 일부 영향
    - 테스트 필수
  높음:
    - 광범위 변경
    - 데이터 영향
    - 서비스 중단 가능
